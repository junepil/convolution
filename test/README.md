# HPC Convolution 테스트 스위트

이 테스트 스위트는 `../conv` 프로그램이 요구사항에 따라 올바르게 작동하는지 검증합니다.

## 테스트 실행 방법

### 1. 기본 컴파일 및 테스트

```bash
# 프로그램 컴파일
make all

# 빠른 기능 테스트 (기존 파일 사용)
make test-quick

# 포괄적 테스트 실행 (모든 엣지케이스 포함)
make test-comprehensive

# 포괄적 테스트 실행 (테스트 데이터 보존)
make test-comprehensive-keep
```

### 2. 개별 테스트 실행

```bash
# Python 스크립트 직접 실행
cd test
python3 main.py

# 테스트 데이터 보존하여 실행
python3 main.py --keep-data

# 다른 경로의 conv 프로그램 테스트
python3 main.py --conv-path /path/to/conv
```

## 테스트 항목

### 1. 기본 파일 입력 테스트

- 기존 f.txt, g.txt 파일을 사용한 convolution 연산
- 출력 크기가 입력과 동일한지 확인

### 2. 배열 생성 모드 테스트

- `-H`, `-W`, `-kH`, `-kW` 옵션으로 배열 자동 생성
- 정방행렬이 아닌 경우도 포함 (예: 5x7 입력)

### 3. 혼합 모드 테스트

- 파일 경로와 크기를 동시에 지정하여 파일 생성
- 생성된 파일의 크기가 올바른지 확인

### 4. 정방행렬이 아닌 경우

- 다양한 가로세로 비율의 입력 행렬
- 1차원에 가까운 극단적인 경우도 포함

### 5. 엣지 케이스

- 1x1 커널
- 입력보다 큰 커널 (경계 처리)
- 최소/최대 크기 조합

### 6. 대용량 행렬 테스트

- 50x50 크기의 상대적으로 큰 행렬
- 메모리 사용량 및 성능 확인

### 7. 경계값 테스트

- 1x1 최소 크기 입력
- 커널이 입력보다 큰 극단적 경우

### 8. 정확성 검증 테스트

- **간단한 정확성 검증**: 3x3 입력과 커널로 수학적 결과 검증
- **복잡한 정확성 검증**: 5x4 입력, 3x3 커널로 정방행렬이 아닌 경우 검증
- **엣지 커널 정확성**: 1x1 커널로 identity 연산 검증
- **생성된 배열 정확성**: 무작위 생성된 배열의 convolution 결과 검증

### 9. 수치 안정성 테스트

- 다양한 패턴(ones, sequential, alternating)의 입력으로 안정성 확인
- 극단적인 크기 조합에서의 수치 정확도 검증

### 10. 오류 처리 테스트

- 존재하지 않는 파일 처리
- 잘못된 인자에 대한 프로그램 동작

## 요구사항 검증

이미지에서 제시된 요구사항을 모두 검증합니다:

1. **옵션 조합별 분기 처리**

   - 파일 입력 모드 (`-f`, `-g`)
   - 배열 생성 모드 (`-H`, `-W`, `-kH`, `-kW`)
   - 혼합 모드 (둘 다 지정)

2. **정방행렬이 아닌 경우 처리**

   - 2x8, 8x2, 1x10, 10x1 등 다양한 비율
   - 모든 경우에서 올바른 출력 크기 보장

3. **경계 조건 처리**
   - 커널이 입력보다 큰 경우
   - 최소 크기 입력 처리
   - 메모리 할당 및 해제

## 결과 해석

- ✅ PASS: 테스트 성공
- ❌ FAIL: 테스트 실패 (원인과 함께 출력)
- 최종 성공률이 100%가 되어야 모든 요구사항 충족

## 생성된 데이터 확인

`test-comprehensive-keep` 또는 `--keep-data` 옵션 사용 시 다음과 같은 파일들이 보존됩니다:

- **배열 파일들** (`.txt`): 테스트에 사용된 입력, 커널, 출력 행렬
- **메타데이터 파일들** (`.json`): 테스트 조건과 예상 결과 정보

### 예시 파일들

- `generated_f.txt`: 무작위 생성된 입력 배열
- `generated_g.txt`: 무작위 생성된 커널 배열
- `generated_output.txt`: 실제 convolution 결과
- `generated_arrays_metadata.json`: 예상 결과와 비교 정보

## 정리

테스트 완료 후 생성된 임시 파일들은 자동으로 정리됩니다:

```bash
make clean  # 모든 생성 파일 정리
```
